rules:
  - title: Malicious File Download and Suspicious Script Execution Detection
    id: s1
    description: |
      This rule detects endpoint security events where users download files flagged as malware, execute abnormal scripts, 
      or open potentially dangerous file types that are not commonly used. Such actions often result from phishing or malware attacks.
    stage: Initial Access
    technique: Phishing
    tags:
      - attack.phishing
      - attack.malware
      - endpoint.security
    logsource:
      category: endpoint-security
      product: any
    detection:
      selection_malicious_file_download:
        event_type: "ENDPOINT ALERT"
        message: "Malicious File Download Detected"
        file_name:
          - "*.exe"
          - "*.js"
          - "*.bat"
        condition:
          alert_type: "malware"
          time_window: 10
      selection_suspicious_script_execution:
        event_type: "ENDPOINT ALERT"
        message: "Suspicious Script Execution Detected"
        script_type:
          - "PowerShell"
          - "macro"
        related_file:
          - "*.docm"
          - "*.xlsm"
        condition:
          alert_type: "suspicious"
          time_window: 10
      selection_dangerous_file_type_opened:
        event_type: "ENDPOINT ALERT"
        message: "Potentially Dangerous File Type Opened"
        file_type:
          - "*.exe"
          - "*.js"
          - "*.bat"
        condition:
          uncommon_usage: true
          time_window: 5
      condition: selection_malicious_file_download or selection_suspicious_script_execution or selection_dangerous_file_type_opened
    falsepositives:
      - Authorized IT activities involving script execution
      - Scheduled system or software updates that require .exe files
      - Legitimate use of macros in controlled environments
    level: medium

  - title: Suspicious Keylogger Process and Log File Creation Detection
    id: s2
    description: |
      Detects processes potentially performing keylogging activities by monitoring keyboard inputs 
      and creating files that store captured keystrokes. This rule helps identify unauthorized 
      credential access attempts through keylogging.
    stage: Credential Access
    technique: Keylogging
    tags:
      - attack.credential-access
      - attack.keylogging
      - endpoint.security
    logsource:
      category: endpoint-security
      product: any
    detection:
      selection_keylogger_process:
        event_type: "ENDPOINT ALERT"
        message: "Suspicious Keylogger Process Detected"
        process_name:
          - "keylogger.exe"
          - "logger.exe"
          - "spyware.exe"
        condition:
          behavior: "input_monitoring"
          suspicious_activity: true
          time_window: 10
      selection_log_file_creation:
        event_type: "ENDPOINT ALERT"
        message: "Suspicious Keystroke Log File Created"
        file_path:
          - "C:\\Temp\\keys_log.txt"
          - "/tmp/keys_log.txt"
        associated_process:
          - "malicious.exe"
        condition:
          unusual_file_creation: true
          time_window: 10
      condition: selection_keylogger_process or selection_log_file_creation
    falsepositives:
      - Authorized IT applications with keylogging components for accessibility or debugging
      - Legitimate administrative monitoring software
    level: high

  - title: Keylogger Detection and Suspicious Device Access
    id: s3
    description: |
      This rule detects alerts from anti-virus and endpoint detection and response (EDR) systems 
      flagging known keylogger signatures and monitoring unusual access to keyboard input devices. 
      It helps identify unauthorized credential access attempts through keylogging.
    stage: Credential Access
    technique: Keylogging
    tags:
      - attack.credential-access
      - attack.keylogging
      - endpoint.security
    logsource:
      category:
        - anti-virus
        - endpoint-detection-response
      product: any
    detection:
      selection_keylogger_malware_detection:
        event_type: "ANTI-VIRUS ALERT"
        message: "Keylogger Malware Detected"
        content: "Detected and quarantined keylogger malware"
        condition:
          alert_type: "malware"
          time_window: 10
      selection_suspicious_device_access:
        event_type: "EDR ALERT"
        message: "Suspicious access to keyboard input devices"
        content: "Unusual access to keyboard input devices"
        condition:
          suspicious_activity: true
          time_window: 10
      condition: selection_keylogger_malware_detection or selection_suspicious_device_access
    falsepositives:
      - Authorized IT applications with monitoring components for accessibility or debugging
      - Legitimate software that may access keyboard devices under normal operation
    level: high


  - title: Ransomware Detection and Unauthorized Encryption Attempt Monitoring
    id: s4
    description: |
      This rule reviews anti-virus and Endpoint Detection and Response (EDR) logs for alerts related to recognized ransomware signatures, including but not limited to known variants, and any failed encryption attempts by untrusted applications. Prompt detection of these threats enables rapid response and containment.
    stage: Initial Access
    technique: Ransomware
    tags:
      - attack.ransomware
      - attack.encryption
      - endpoint.security
    logsource:
      category: antivirus
      category: endpoint-detection-response
      product: any
    detection:
      selection_ransomware_signature:
        event_type: "ANTIVIRUS ALERT"
        message: "Ransomware Signature Detected"
        signature_name:
          - "LockBit"
          - "Ryuk"
          - "WannaCry"
          - "Cerber"
          - "CryptoLocker"
          - "REvil"
        condition:
          alert_type: "ransomware"
          time_window: 10 # in seconds
      selection_failed_encryption_attempt:
        event_type: "ENDPOINT ALERT"
        message: "Unauthorized Encryption Attempt Blocked"
        application_name: 
          - "malicious_app.exe"  # Example of an untrusted application
        condition:
          unauthorized_encryption: true
          time_window: 10 # in seconds
      condition: selection_ransomware_signature or selection_failed_encryption_attempt
    falsepositives:
      - Authorized encryption applications for legitimate business use
      - Routine system maintenance tasks that may involve file encryption
      - Legitimate software that may trigger false positives
    level: high

# title: Dynamic Ransomware Detection with Threat Intelligence Feed
# id: 4
# description: |
#   This rule leverages threat intelligence feeds to dynamically detect known ransomware signatures and monitor for unauthorized encryption attempts by untrusted applications. The rule automatically updates with new indicators from the TIF.
# stage: Initial Access
# technique: Ransomware
# tags:
#   - attack.ransomware
#   - attack.encryption
#   - threat-intelligence
# logsource:
#   category: antivirus
#   category: endpoint-detection-response
#   product: any
# detection:
#   selection_dynamic_ransomware_signature:
#     event_type: "ANTIVIRUS ALERT"
#     message: "Ransomware Signature Detected via TIF"
#     signature_name: 
#       # Assuming `tif` is a variable that pulls from a dynamic threat feed
#       - "${tif.ransomware_signatures}"  # Placeholder for dynamic TIF values
#     condition:
#       alert_type: "ransomware"
#       time_window: 10 # in seconds
#   selection_failed_encryption_attempt:
#     event_type: "ENDPOINT ALERT"
#     message: "Unauthorized Encryption Attempt Blocked"
#     application_name: 
#       - "${tif.untrusted_applications}"  # Placeholder for dynamic TIF values
#     condition:
#       unauthorized_encryption: true
#       time_window: 10 # in seconds
#   condition: selection_dynamic_ransomware_signature or selection_failed_encryption_attempt
# falsepositives:
#   - Authorized encryption applications for legitimate business use
#   - Routine system maintenance tasks that may involve file encryption
#   - Legitimate software that may trigger false positives
# level: high

  - title: Unauthorized Memory Access and Credential Dumping Detection
    id: s5
    description: |
      Detects unauthorized attempts to access sensitive processes such as lsass.exe, which is often targeted for credential dumping.
      The rule also identifies unusual memory dump activity from multiple known tools that are used to extract credentials from memory.
    stage: Credential Access
    technique: Credential Dumping
    tags:
      - attack.credential-access
      - attack.credential-dumping
      - endpoint.security
    logsource:
      category: endpoint-detection-response
      product: any
    detection:
      selection_memory_access:
        event_type: "EDR ALERT"
        message: "Unauthorized Memory Access Attempt on lsass.exe"
        process_name: "*.*"  # Matches any process name
        # process_name: "unknown_tool.exe"  # Placeholder for any tool that accesses lsass.exe
        condition:
          target_process: "lsass.exe"  # Monitoring for unauthorized access attempts
          access_type: "memory"  # Indicates that memory access is being attempted
          success: false
          suspicious_activity: true
      selection_memory_dump_activity:
        event_type: "EDR ALERT"
        message: "Unusual Memory Dump Activity Detected"
        tools:
          - "Mimikatz"
          - "ProcDump"
          - "Windows Credential Editor"
          - "RogueKiller"
          - "Koadic"
          - "PowerSploit"
          - "gsecdump"
        condition:
          suspicious_tool: true  # Flags if any of the listed tools are detected
          action: "dump"  # Indicates a memory dump action
      condition: selection_memory_access or selection_memory_dump_activity
    falsepositives:
      - Authorized security tools performing memory analysis
      - Legitimate administrative tasks requiring access to lsass.exe
      - Controlled testing environments for credential management
    level: high

  - title: Unauthorized Screen Capturing Activity Detection
    id: s6
    description: |
      Detects unauthorized screen capturing activities by monitoring endpoint security logs for alerts triggered by applications accessing display buffers or screen capture functionalities. This may indicate potential data collection attempts by malicious software.
    stage: Data Collection
    technique: Screen Capture
    tags:
      - attack.data-collection
      - attack.screen-capture
      - endpoint.security
    logsource:
      category: endpoint
      product: any
    detection:
      selection_screen_capture_access:
        event_type: "ENDPOINT SECURITY ALERT"
        message: "Application accessing display buffer or screen capture functionalities"
        application_name:
          - "CaptureTool"              
          - "ScreenCapturePro"         
          - "Snagit"                   
          - "Greenshot"                
          - "ShareX"                   
          - "OBS Studio"               
          - "Windows Snipping Tool"    
          - "AnyDesk"                  
          - "TeamViewer"               
        condition:
          # user: "{{ user_config.users }}"
          unauthorized_access: true     # Flag for unauthorized access
          time_window: 60                # Time window for monitoring (in seconds)
      condition: selection_screen_capture_access
    falsepositives:
      - Legitimate use of screen capture tools for approved tasks
      - Authorized security testing involving screen capture
      - Users capturing their screens for training or support purposes
    level: high

# user_config:
#   users:
#     - "user1"
#     - "user2"
#     - "employee123"
#   sensitive_files:
#     - "/path/to/sensitive/file1.txt"
#     - "/path/to/sensitive/file2.csv"

# File Access

# title: Dynamic Sensitive File Access Detection
# id: 7
# description: |
#   Detects suspicious access to sensitive files by monitoring access patterns of specified users and built-in sensitive directories. 
#   The rule allows for user-defined sensitive users and folders through a configuration file.
# stage: Data Collection
# technique: File Collection
# tags:
#   - attack.data-collection
#   - attack.file-collection
#   - system.security
# logsource:
#   category: file_access
#   product: any
# detection:
#   selection_suspicious_access:
#     event_type: "FILE ACCESS ALERT"
#     user: "{{ user_config.users }}"  # Load user-defined sensitive users from configuration
#     file_accessed: "{{ user_config.sensitive_files }}"  # Load user-defined sensitive files from configuration
#     condition:
#       time_window: 60 # in seconds
#       abnormal_access_pattern: true  # Detects unusual access patterns
#   selection_builtin_sensitive_folders:
#     event_type: "FILE ACCESS ALERT"
#     file_accessed:
#       - "/etc/sensitive_directory"  # Built-in sensitive directory
#       - "/var/www/html"  # Another built-in sensitive directory
#     condition:
#       time_window: 60 # in seconds
#       abnormal_access_pattern: true
#   condition: selection_suspicious_access or selection_builtin_sensitive_folders
# falsepositives:
#   - Routine administrative access
#   - Authorized access by security personnel
# level: high

# users:
#   - "user1"
#   - "user2"
#   - "employee123"
# sensitive_files:
#   - "/path/to/sensitive/file1.txt"
#   - "/path/to/sensitive/file2.csv"

  - title: Large-Scale File Deletion and Overwrite Detection
    id: s7
    description: |
      Monitors for large-scale file deletions and overwrites, which may indicate data destruction activities. 
      The rule triggers alerts based on defined thresholds for file operations in a specified time window.
    stage: Impact
    technique: Data Destruction
    tags:
      - attack.data-destruction
      - attack.file-collection
      - system.security
    logsource:
      category: file_access
      product: any
    detection:
      selection_mass_deletion:
        event_type: "FILE ACCESS ALERT"
        action: "delete"  # Specifies the action type being monitored
        threshold: 
          type: both
          track: by_dir
          count: 1000  # Threshold for deletions
          seconds: 60  # Time window for the detection
      selection_significant_overwrite:
        event_type: "FILE ACCESS ALERT"
        action: "overwrite"  # Specifies the action type being monitored
        threshold: 
          type: both
          track: by_file
          count: 100  # Threshold for overwrites
          seconds: 60  # Time window for the detection
      condition: selection_mass_deletion or selection_significant_overwrite
    falsepositives:
      - Routine system maintenance
      - Scheduled backup processes
      - User-initiated file cleanups
    level: high

  # File Integrity
  - title: File Integrity Monitoring for Unauthorized Changes
    id: s8
    description: |
      Detects unauthorized changes to files or directories, particularly in web upload directories 
      and critical directories, which may indicate the placement of backdoors or other malicious files.
    stage: Installation or Persistance
    technique: Backdoors
    tags:
      - attack.installation
      - attack.persistence
      - file-integrity
    logsource:
      category: file-integrity
      product: any
    detection:
      selection_file_change_upload:
        event_type: "FILE ALERT"
        message: "Unauthorized File Change Detected in Web Upload Directory"
        file_path:
          - "/uploads/"  # Directory for uploaded files
        file_extension:
          - ".php"
          - ".sh"
          - ".bin"
        condition:
          action: "created"  # Can also check for modified or deleted
          time_window: 10 # in seconds
      selection_file_modification_critical:
        event_type: "FILE ALERT"
        message: "Unauthorized File Modification Detected in Critical Directory"
        file_path:
          - "/var/www/"    # Web server root
          - "/home/user/"  # User home directory
        condition:
          action: "modified"  # Checking for unauthorized modifications
          time_window: 10 # in seconds
      selection_unusual_file_appearance:
        event_type: "FILE ALERT"
        message: "Suspicious File Change Detected in Sensitive Directory"
        file_path:
          - "/home/user/"
        file_extension:
          - ".php"
          - ".exe"
          - ".py"
          - ".pl"
        condition:
          action: "created"  # Looking for new suspicious files
          time_window: 10 # in seconds
      condition: selection_file_change_upload or selection_file_modification_critical or selection_unusual_file_appearance
    falsepositives:
      - Legitimate updates or changes to website files
      - Authorized file uploads for legitimate applications
      - Routine administrative changes in critical directories
    level: high

  - title: File Integrity Monitoring for Webshell Indicators
    id: s9
    description: |
      Detects unexpected changes to critical files, particularly in web directories, 
      unauthorized file creations in sensitive directories, and deletion of log files, 
      which may indicate the placement of webshells or malicious activity.
    stage: Web Shell Installation
    technique: Web Shells
    tags:
      - attack.webshells
      - attack.persistence
      - file-integrity
    logsource:
      category: file-integrity
      product: any
    detection:
      selection_file_modification_web_upload:
        event_type: "FILE ALERT"
        message: "Unauthorized Change Detected in Web Upload Directory"
        file_path:
          - "/uploads/"  # Monitoring web upload directory
        condition:
          action: 
            - "modified"
            - "created"  # Detecting unauthorized files in web directories
          file_extension:
            - ".php"  # Common webshell file extensions
            - ".sh"
            - ".bin"
          time_window: 10 # in seconds
      selection_sensitive_file_modification:
        event_type: "FILE ALERT"
        message: "Sensitive File Modification Detected"
        file_path:
          - "/var/www/"  # Monitoring web server root
        condition:
          action: "modified"  # Monitoring for modifications in web server files
          time_window: 10 # in seconds
      selection_log_file_deletion:
        event_type: "FILE ALERT"
        message: "Log File Deletion Attempt Detected"
        file_path:
          - "/var/log/"  # Monitoring log file directory
        condition:
          action: "deleted"  # Detecting deletions
          time_window: 10 # in seconds
      condition: selection_file_modification_web_upload or selection_sensitive_file_modification or selection_log_file_deletion
    falsepositives:
      - Legitimate updates or changes to web files
      - Authorized administrative actions on log files
      - Routine maintenance activities affecting sensitive files
    level: high

  - title: File Integrity Monitoring for Ransomware Indicators
    id: s10
    description: |
      Monitors for significant changes in file integrity, such as unexpected mass encryption of files 
      and modifications in file extensions, indicating potential ransomware activity.
    stage: Impact
    technique: Ransomware
    tags:
      - attack.ransomware
      - attack.data-encryption
      - file-integrity
    logsource:
      category: file-integrity
      product: any
    detection:
      selection_mass_encryption:
        event_type: "FILE INTEGRITY ALERT"
        message: "Mass Encryption Detected"
        condition:
          threshold:
            type: both
            track: by_dir
            count: 50  # Threshold for the number of files encrypted
            seconds: 60  # Time window in seconds
      selection_file_extension_change:
        event_type: "FILE INTEGRITY ALERT"
        message: "Suspicious File Extension Change Detected"
        file_extension:
        - ".encrypted"
        - ".lock"
        - ".locked"
        - ".crypto"
        - ".vault"
        - ".enc"
        - ".aes"
        - ".rar"
        - ".zzz"  
        condition:
          action: "changed"  # Monitoring for changes in file extensions
      condition: selection_mass_encryption or selection_file_extension_change
    falsepositives:
      - Legitimate bulk file updates or encryption activities
      - Authorized backup processes modifying file extensions
      - System or software updates affecting file integrity
    level: high

  # Powershell
  - title: Suspicious PowerShell Activity Related to Credential Dumping
    id: s11
    description: |
      Detects suspicious PowerShell activity, such as encoded script execution, attempts to access lsass.exe memory, 
      and misuse of Get-Credential cmdlet, which are often indicators of credential dumping or credential harvesting.
    stage: Credential Access
    technique: Credential Dumping
    tags:
      - attack.credential-access
      - attack.credential-dumping
      - windows.security
    logsource:
      category: powershell
      product: windows
    detection:
      selection_encoded_command:
        event_type: "POWERSHELL ALERT"
        message: "Suspicious Encoded PowerShell Command Execution"
        command_line:
          - "-EncodedCommand" # Flag used for encoded PowerShell scripts
        condition:
          obfuscation_detected: true
          time_window: 10 # in seconds
      selection_lsass_access:
        event_type: "POWERSHELL ALERT"
        message: "PowerShell Access to lsass.exe Memory Detected"
        command_line:
          - "Invoke-Mimikatz" # Specific command associated with credential dumping
          - "Get-WMIObject"   # Alternative command that may be used for credential access
          - "Dump-Process"     # Generic command to dump processes, possibly for credential harvesting
          - "Read-ProcessMemory" # Method for reading process memory directly
        process_accessed:
          - "lsass.exe" # Target process for credential dumping
        condition:
          process_target: "lsass.exe"
          time_window: 10 # in seconds
      selection_get_credential:
        event_type: "POWERSHELL ALERT"
        message: "Unusual Use of PowerShell Get-Credential Cmdlet"
        command_line:
          - "Get-Credential"
        condition:
          prompt_for_credentials: true # Detects Get-Credential misuse
          time_window: 5 # in seconds
      condition: selection_encoded_command or selection_lsass_access or selection_get_credential
    falsepositives:
      - Legitimate use of PowerShell for administrative tasks
      - Authorized security testing involving credential dumps
      - Legitimate credential requests in managed sessions
    level: high

  # Security
  - title: Unauthorized Privilege Escalation Detection via Buffer Overflow
    id: s12
    description: |
      Detect unauthorized attempts to escalate privileges potentially using buffer overflow vulnerabilities.
      Monitor for suspicious kernel module loads and abnormal privilege escalation attempts following system crashes.
    stage: Exploitation
    technique: Buffer Overflow
    tags:
      - attack.privilege-escalation
      - attack.buffer-overflow
    logsource:
      category: system
      product: any
    detection:
      selection_privilege_escalation:
        event_type: "SYSTEM ALERT"
        message: "Unauthorized Privilege Escalation Attempt Detected"
        process:
          - "su"
          - "sudo"
          - "setuid"
          - "runas"         # Windows-specific
          - "elevate"       # macOS-specific
        condition:
          privilege_level: "root"       # Linux/macOS
          admin_level: "administrator"  # Windows
          success: false
          time_window: 5 # in seconds
      selection_kernel_module_load:
        event_type: "SYSTEM ALERT"
        message: "Unauthorized Kernel Module Loaded"
        kernel_module:
          - "any" # Specific modules can be listed if known
        condition:
          abnormality: "high"
          success: true
          time_window: 10 # in seconds
      selection_crash_event:
        event_type: "SYSTEM EVENT"
        message: "System Crash or Abnormal Event Detected"
        event_code:
          - "CRASH" # Linux/macOS
          - "1001"  # Windows Event ID for system crash
        condition:
          time_window: 60 # in seconds
      condition: selection_privilege_escalation or selection_kernel_module_load or selection_crash_event
    falsepositives:
      - Authorized kernel module updates
      - Testing activities in controlled environments
      - Routine system updates requiring temporary elevation
    level: high


  - title: Unauthorized Privilege Escalation and Suspicious Kernel Module Activity
    id: s13
    description: |
      Detects unauthorized attempts to gain root or administrative privileges, suspicious loading of kernel modules, 
      and abnormal use of privileged commands, which may indicate an exploit or privilege escalation attempt.
    stage: Exploitation
    techneque: Privilege Escalation
    tags:
      - attack.privilege-escalation
      - attack.kernel-exploit
      - system.security
    logsource:
      category: system
      product: any
    detection:
      selection_unauthorized_privilege_attempt:
        event_type: "SYSTEM ALERT"
        message: "Unauthorized Privilege Escalation Attempt"
        process:
          - "su"
          - "sudo"
          - "runas"
        condition:
          privilege_level: "*root*"  # Detects attempts to gain root privileges
          success: false
          time_window: 10 # in seconds
      selection_suspicious_kernel_module:
        event_type: "SYSTEM ALERT"
        message: "Suspicious Kernel Module Loaded"
        kernel_module_action: "load"
        condition:
          abnormality: "high"  # Flags unusual or unauthorized module loading
          success: true
          time_window: 10 # in seconds
      selection_privileged_command_usage:
        event_type: "SYSTEM ALERT"
        message: "Abnormal Use of Privileged Commands"
        command:
          - "/bin/chmod"      # Potentially sensitive binaries
          - "/bin/chown"
          - "/bin/lsmod"
          - "/sbin/insmod"
          - "/sbin/rmmod"
          - "/usr/bin/apt-get"  # Linux-specific package manager
          - "/usr/sbin/service"
          - "powershell"        # For Windows, if logs allow cross-platform detection
        condition:
          abnormal_usage: "true"  # Detects usage of sensitive binaries without proper authorization
          time_window: 5 # in seconds
      condition: selection_unauthorized_privilege_attempt or selection_suspicious_kernel_module or selection_privileged_command_usage
    falsepositives:
      - Scheduled or authorized kernel/module updates
      - Routine maintenance requiring elevated privileges
      - Controlled system testing activities
    level: high

  # Windows Event
  - title: Detection of Unusual Kerberos Authentication Patterns
    id: s14
    description: |
      Detects potential suspicious activities by monitoring Windows Event Logs for unusual Kerberos authentication patterns,
      including TGT requests from unexpected systems or users, and abnormal TGS requests targeting multiple systems.
    stage: Lateral Movement
    technique: Pass the Hash or Pass the Ticket
    tags:
      - lateral.movement
      - kerberos
      - authentication.abuse
      - anomaly.detection
    logsource:
      category: windows_event
    detection:
      unusual_tgt_requests:
        event_id: 4768
        message: "Unusual TGT request detected"
        src_system: "Any unexpected system (e.g., 'Workstation-05')"
        user: "Any user (e.g., 'admin')"
        condition: 
          description: "Monitor for TGT requests from systems or users that don’t typically interact with each other."
      unusual_tgs_requests:
        event_id: 4769
        message: "Unusual TGS request detected"
        src_system: "Any unexpected system (e.g., 'Workstation-05')"
        user: "Any user (e.g., 'admin')"
        service: "Any sensitive service (e.g., 'cifs/server1')"
        condition: 
          description: "Track abnormal TGS requests where attackers might be requesting service tickets to access multiple systems."
    falsepositives:
      - Legitimate administrative actions where an admin uses unexpected systems for valid purposes.
      - Scheduled tasks or automated scripts running from unusual systems.
      - Users accessing services for legitimate reasons that may appear anomalous.
    level: high

  - title: Detection of Unusual Interactions with Credential Processes
    id: s15
    description: |
      Detects potential credential dumping or unauthorized access attempts by monitoring Windows Event Logs
      for unusual interactions with lsass.exe or other processes handling sensitive credentials, such as attempts 
      to read or modify their memory.
    stage: Lateral Movement
    technique: Credential Dumping
    tags:
      - credential.dumping
      - lsass
      - anomaly.detection
      - process.monitoring
    logsource:
      category: windows_event
      product: windows
    detection:
      suspicious_lsass_access:
        event_id: 4688  # event for new process creation
        message: "Suspicious access to lsass.exe detected"
        process_name: "mimikatz.exe"  # Example of a known credential dumping tool
        target_process: "lsass.exe"
        condition:
          description: "Monitor for processes attempting to read or modify lsass.exe memory."

      abnormal_process_creation:
        event_id: 4688  # event for new process creation
        message: "Abnormal process creation detected"
        process_name: "gsecdump.exe"  # Another known credential dumping tool
        target_process: "lsass.exe"
        condition:
          description: "Track processes attempting to read memory of lsass.exe."

    falsepositives:
      - Legitimate security tools performing authorized memory analysis.
      - Administrative actions where scripts or tools interact with lsass.exe for valid purposes.
      - Scheduled tasks or automated processes accessing lsass.exe for legitimate reasons.

    level: high

  - title: Detection of Unusual Logon Attempts
    id: s16
    description: |
      Detects potential unauthorized access by monitoring Windows Event Logs for successful logon attempts 
      (Event ID 4624) made through RDP or SMB from non-standard IP addresses or unusual user accounts.
    stage: Lateral Movement
    technique: Remote Desktop Protocol (RDP) or SMB exploitation
    tags:
      - lateral.movement
      - unauthorized.access
      - rdp
      - smb
      - anomaly.detection
    logsource:
      category: windows_event
      product: windows
    detection:
      unusual_rdp_logon:
        event_id: 4624
        message: "Unusual RDP logon detected"
        user: "Any user (e.g., 'admin')"
        src_ip: "Any non-standard IP address (e.g., '203.0.113.1')"
        condition:
          description: "Monitor for RDP logons from IP addresses not typically associated with the user."
      unusual_smb_logon:
        event_id: 4624
        message: "Unusual SMB logon detected"
        user: "Any unusual user account (e.g., 'guest')"
        src_ip: "Any non-standard IP address (e.g., '192.168.1.10')"
        condition:
          description: "Track SMB logons from user accounts that typically do not access systems via SMB."
    falsepositives:
      - Authorized users logging in from remote locations.
      - Service accounts or automated processes using unusual IP addresses.
      - Users connecting from legitimate but non-standard networks (e.g., VPNs).
    level: high

  # Authentication
  - title: Detection of Multiple Logins from Same User Across Different Systems
    id: s17
    description: |
      Detects potential lateral movement or credential theft by monitoring authentication logs for multiple logins from the same user account across different systems or within a short time window. Unusual login patterns may suggest that an attacker is using stolen credentials to move across the network.
    stage: Lateral Movement
    technique: Pass-the-ticket or Pass-the-Hash
    tags:
      - lateral.movement
      - credential.theft
      - anomaly.detection
    logsource:
      category: authentication_logs
    detection:
      multiple_logins_across_systems:
        event_id: 4624 # Successful logon event
        message: "Multiple logins detected from the same user account across different systems"
        src_user: "admin"  # Any high-privilege user or specific user you are monitoring
        condition:
          description: "Monitor for logins from the same user across multiple systems within a short time window (e.g., within 2 minutes)."
          time_window: "2 minutes"
          systems_involved:
            - "Server-01"
            - "Workstation-05"
      repeated_high_privilege_logins:
        event_id: 4624 # Successful logon event
        message: "Repeated logins detected from high-privilege accounts"
        src_user: "admin"  # High-privilege account (e.g., 'admin', 'root')
        condition:
          description: "Track logins from high-privilege accounts across multiple systems, which typically don’t move frequently."
          high_privilege_user: true
          systems_involved:
            - "Server-01"
            - "Workstation-05"
    falsepositives:
      - Legitimate administrative activities or troubleshooting tasks.
      - Automated scripts or management tasks that require access to multiple systems.
      - Systems where user behavior is legitimate and expected to occur across multiple machines.
    level: high
